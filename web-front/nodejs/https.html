<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Https | 好记性不如烂笔头</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="Just playing around">
    <link rel="preload" href="/blog/assets/css/0.styles.5608eb1c.css" as="style"><link rel="preload" href="/blog/assets/js/app.aa2e657f.js" as="script"><link rel="preload" href="/blog/assets/js/2.0be12a73.js" as="script"><link rel="preload" href="/blog/assets/js/12.b02e26d5.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.8a689b7d.js"><link rel="prefetch" href="/blog/assets/js/100.1eb2b1f4.js"><link rel="prefetch" href="/blog/assets/js/101.e3bb63ea.js"><link rel="prefetch" href="/blog/assets/js/102.d96b81e1.js"><link rel="prefetch" href="/blog/assets/js/103.8df252f8.js"><link rel="prefetch" href="/blog/assets/js/104.67456970.js"><link rel="prefetch" href="/blog/assets/js/105.c6e49846.js"><link rel="prefetch" href="/blog/assets/js/106.f458a078.js"><link rel="prefetch" href="/blog/assets/js/107.26a05cdf.js"><link rel="prefetch" href="/blog/assets/js/108.59c4e8bd.js"><link rel="prefetch" href="/blog/assets/js/109.f233ccf6.js"><link rel="prefetch" href="/blog/assets/js/11.5ae2d9d8.js"><link rel="prefetch" href="/blog/assets/js/110.5bfc12d0.js"><link rel="prefetch" href="/blog/assets/js/111.9d74b845.js"><link rel="prefetch" href="/blog/assets/js/112.3995bff9.js"><link rel="prefetch" href="/blog/assets/js/113.dc24755b.js"><link rel="prefetch" href="/blog/assets/js/114.ac3efc59.js"><link rel="prefetch" href="/blog/assets/js/115.6cb32104.js"><link rel="prefetch" href="/blog/assets/js/116.2de4359c.js"><link rel="prefetch" href="/blog/assets/js/117.d1708d0c.js"><link rel="prefetch" href="/blog/assets/js/118.bc76f735.js"><link rel="prefetch" href="/blog/assets/js/119.cd7797b2.js"><link rel="prefetch" href="/blog/assets/js/120.e92fb25b.js"><link rel="prefetch" href="/blog/assets/js/13.c1a54827.js"><link rel="prefetch" href="/blog/assets/js/14.a0e9de02.js"><link rel="prefetch" href="/blog/assets/js/15.72f10295.js"><link rel="prefetch" href="/blog/assets/js/16.a76dcdf0.js"><link rel="prefetch" href="/blog/assets/js/17.c6bc6d95.js"><link rel="prefetch" href="/blog/assets/js/18.cd90343e.js"><link rel="prefetch" href="/blog/assets/js/19.d286e255.js"><link rel="prefetch" href="/blog/assets/js/20.6f542003.js"><link rel="prefetch" href="/blog/assets/js/21.15d6add3.js"><link rel="prefetch" href="/blog/assets/js/22.2f210b06.js"><link rel="prefetch" href="/blog/assets/js/23.cc91f39f.js"><link rel="prefetch" href="/blog/assets/js/24.e229ae92.js"><link rel="prefetch" href="/blog/assets/js/25.a2512ed5.js"><link rel="prefetch" href="/blog/assets/js/26.07e23bac.js"><link rel="prefetch" href="/blog/assets/js/27.e784bab2.js"><link rel="prefetch" href="/blog/assets/js/28.3bda3fed.js"><link rel="prefetch" href="/blog/assets/js/29.462f4b2d.js"><link rel="prefetch" href="/blog/assets/js/3.e65d668d.js"><link rel="prefetch" href="/blog/assets/js/30.6a2fe01d.js"><link rel="prefetch" href="/blog/assets/js/31.153cfceb.js"><link rel="prefetch" href="/blog/assets/js/32.8ac3b6ae.js"><link rel="prefetch" href="/blog/assets/js/33.2c5c2f27.js"><link rel="prefetch" href="/blog/assets/js/34.a03d5a6a.js"><link rel="prefetch" href="/blog/assets/js/35.c704383d.js"><link rel="prefetch" href="/blog/assets/js/36.d13a4468.js"><link rel="prefetch" href="/blog/assets/js/37.06ac3b2f.js"><link rel="prefetch" href="/blog/assets/js/38.732e8a33.js"><link rel="prefetch" href="/blog/assets/js/39.71f558ca.js"><link rel="prefetch" href="/blog/assets/js/4.785e9220.js"><link rel="prefetch" href="/blog/assets/js/40.e0833fc2.js"><link rel="prefetch" href="/blog/assets/js/41.6aae7339.js"><link rel="prefetch" href="/blog/assets/js/42.7d21f31a.js"><link rel="prefetch" href="/blog/assets/js/43.6b9acb55.js"><link rel="prefetch" href="/blog/assets/js/44.9387d4fa.js"><link rel="prefetch" href="/blog/assets/js/45.3d40a191.js"><link rel="prefetch" href="/blog/assets/js/46.4ef9e827.js"><link rel="prefetch" href="/blog/assets/js/47.7416afb8.js"><link rel="prefetch" href="/blog/assets/js/48.7ba1ed70.js"><link rel="prefetch" href="/blog/assets/js/49.b0d00c32.js"><link rel="prefetch" href="/blog/assets/js/5.3a78ac53.js"><link rel="prefetch" href="/blog/assets/js/50.590eade3.js"><link rel="prefetch" href="/blog/assets/js/51.41f394f7.js"><link rel="prefetch" href="/blog/assets/js/52.584dcdad.js"><link rel="prefetch" href="/blog/assets/js/53.1d826c95.js"><link rel="prefetch" href="/blog/assets/js/54.42951a50.js"><link rel="prefetch" href="/blog/assets/js/55.114312f6.js"><link rel="prefetch" href="/blog/assets/js/56.6d5a1622.js"><link rel="prefetch" href="/blog/assets/js/57.7773a855.js"><link rel="prefetch" href="/blog/assets/js/58.12e413f7.js"><link rel="prefetch" href="/blog/assets/js/59.ec480fb3.js"><link rel="prefetch" href="/blog/assets/js/6.17004985.js"><link rel="prefetch" href="/blog/assets/js/60.ea0b64ee.js"><link rel="prefetch" href="/blog/assets/js/61.107143ab.js"><link rel="prefetch" href="/blog/assets/js/62.e88dd12b.js"><link rel="prefetch" href="/blog/assets/js/63.fddbff6e.js"><link rel="prefetch" href="/blog/assets/js/64.b6927a8a.js"><link rel="prefetch" href="/blog/assets/js/65.71fbe367.js"><link rel="prefetch" href="/blog/assets/js/66.8ad59b0d.js"><link rel="prefetch" href="/blog/assets/js/67.6e627af2.js"><link rel="prefetch" href="/blog/assets/js/68.12fe5e3f.js"><link rel="prefetch" href="/blog/assets/js/69.94ac4b31.js"><link rel="prefetch" href="/blog/assets/js/7.4418371a.js"><link rel="prefetch" href="/blog/assets/js/70.a49f1dd2.js"><link rel="prefetch" href="/blog/assets/js/71.9a86dc10.js"><link rel="prefetch" href="/blog/assets/js/72.b5bdb4e6.js"><link rel="prefetch" href="/blog/assets/js/73.30eeeea8.js"><link rel="prefetch" href="/blog/assets/js/74.fa11e25f.js"><link rel="prefetch" href="/blog/assets/js/75.cb18b2ad.js"><link rel="prefetch" href="/blog/assets/js/76.7d7c43f4.js"><link rel="prefetch" href="/blog/assets/js/77.2201fe9f.js"><link rel="prefetch" href="/blog/assets/js/78.92e99183.js"><link rel="prefetch" href="/blog/assets/js/79.dee94e8c.js"><link rel="prefetch" href="/blog/assets/js/8.0b5d024f.js"><link rel="prefetch" href="/blog/assets/js/80.b4a72d97.js"><link rel="prefetch" href="/blog/assets/js/81.b2461950.js"><link rel="prefetch" href="/blog/assets/js/82.af884031.js"><link rel="prefetch" href="/blog/assets/js/83.c9f7d174.js"><link rel="prefetch" href="/blog/assets/js/84.ca0f126d.js"><link rel="prefetch" href="/blog/assets/js/85.fb27da08.js"><link rel="prefetch" href="/blog/assets/js/86.31326297.js"><link rel="prefetch" href="/blog/assets/js/87.072c0cfc.js"><link rel="prefetch" href="/blog/assets/js/88.77398eb4.js"><link rel="prefetch" href="/blog/assets/js/89.f2d4cba7.js"><link rel="prefetch" href="/blog/assets/js/9.6c838714.js"><link rel="prefetch" href="/blog/assets/js/90.7adfce7b.js"><link rel="prefetch" href="/blog/assets/js/91.d08c45c0.js"><link rel="prefetch" href="/blog/assets/js/92.8429831c.js"><link rel="prefetch" href="/blog/assets/js/93.60c727c9.js"><link rel="prefetch" href="/blog/assets/js/94.7b5b94dc.js"><link rel="prefetch" href="/blog/assets/js/95.129264c6.js"><link rel="prefetch" href="/blog/assets/js/96.7b43c927.js"><link rel="prefetch" href="/blog/assets/js/97.5ada8a67.js"><link rel="prefetch" href="/blog/assets/js/98.29a0a70c.js"><link rel="prefetch" href="/blog/assets/js/99.aa906656.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.5608eb1c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">好记性不如烂笔头</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/networking-protocol/" class="nav-link">
  网络协议
</a></div><div class="nav-item"><a href="/blog/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/blog/design-pattern/" class="nav-link">
  设计模式
</a></div><div class="nav-item"><a href="/blog/ios/" class="nav-link">
  iOS
</a></div><div class="nav-item"><a href="/blog/js-study/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/blog/problems/" class="nav-link">
  面试题
</a></div> <a href="https://xuqisheng1.github.io/blog/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/networking-protocol/" class="nav-link">
  网络协议
</a></div><div class="nav-item"><a href="/blog/algorithm/" class="nav-link">
  算法
</a></div><div class="nav-item"><a href="/blog/design-pattern/" class="nav-link">
  设计模式
</a></div><div class="nav-item"><a href="/blog/ios/" class="nav-link">
  iOS
</a></div><div class="nav-item"><a href="/blog/js-study/" class="nav-link">
  JS
</a></div><div class="nav-item"><a href="/blog/problems/" class="nav-link">
  面试题
</a></div> <a href="https://xuqisheng1.github.io/blog/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="https"><a href="#https" class="header-anchor">#</a> Https</h1> <p>HTTPS（全称：HyperText Transfer Protocol over Secure Socket Layer），它是浏览器与 Web 服务器之间的应用层通信协议。</p> <p>HTTPS 可以理解为 HTTP+SSL/TLS。SSL 协议是由网景公司研发的位于 TCP/IP 协议与各种应用层协议之间，为数据通信提供安全支持的一种协议。</p> <p>TLS（Transport Layer Security）：前身是 SSL，它最初的几个版本（SSL 1.0、SSL 2.0、SSL 3.0）由网景公司开发，93 年 3.1 版本开始被 IETF 标准化并改名，发展至今已经有 TLS1.0、TLS1.1、TLS1.2。</p> <h2 id="加密算法"><a href="#加密算法" class="header-anchor">#</a> 加密算法</h2> <h3 id="对称加密"><a href="#对称加密" class="header-anchor">#</a> 对称加密</h3> <p>加密和解密都使用同一个密钥，有流式和分组两种。</p> <ol><li><p>工作过程
发送方使用密钥将明文数据加密成密文，然后发送出去。接收方收到密文后，使用同一个密钥将密文解密成明文。</p></li> <li><p>优点
加解密计算量小，速度快</p></li> <li><p>缺点</p></li></ol> <ul><li><p>密钥传输问题。如何把密钥安全的传递到解密者手里？客户端如果把密钥存储在本地是不可取的，因为客户端被反编译之后，密钥容易泄露。实际中，一般是客户端向服务端请求对称加密的密钥，密钥还要用非对称加密加密之后再传输。</p></li> <li><p>密钥管理问题。当客户端数量增多，所有客户端使用同一个密钥，容易造成密钥泄露。如果为每个客户端生成一个密钥，这样的管理成本也很大。</p></li></ul> <ol start="4"><li>常用的对称加密算法
DES， AES-GCM, ChaCha20-Ploly1305 等</li></ol> <h3 id="非对称加密"><a href="#非对称加密" class="header-anchor">#</a> 非对称加密</h3> <p>加密的密钥和解密的密钥不同，分为公钥和私钥。</p> <ol><li>优点
公钥和算法公开，这样每个客户端都能用（黑客也能拿到公钥）。私钥保密,安全性高。</li></ol> <p>既然非对称加密算法安全性这么高，那我们全部用非对称加密行吗？答案肯定是不行的。凡事都有两面性。</p> <ol start="2"><li>缺点</li></ol> <ul><li><p>非对称加密算法计算量大，性能低，能够加密的数据长度有限。以 RSA 算法为例，它的密钥有 256/512/1024/2048/4096 等不同的长度。长度越长，密码强度越大，当然计算速度也越慢。使用 512bit 的 RSA 加密时，明文长度不能超过 53 字节，使用 1024bit 的 RSA 加密时，明文长度不能超过 117 字节</p></li> <li><p>只使用非对称加密不能防止劫持。由于公钥是公开的，如果黑客拿到公钥和私钥加密后的内容，那么也可以使用公钥解密获取其中的内容。</p></li></ul> <ol start="3"><li>常用非对称加密算法
RSA, DSA, ECDSA, DH, ECDHE</li></ol> <h3 id="哈希算法"><a href="#哈希算法" class="header-anchor">#</a> 哈希算法</h3> <p>将任意长度的信息转换为较短的固定长度的值，通常其长度要比信息小得多，且算法不可逆。</p> <p>例如：MD5、SHA-1、SHA-2、SHA-256 等</p> <h3 id="数字签名"><a href="#数字签名" class="header-anchor">#</a> 数字签名</h3> <p>签名就是在信息的后面再加上一段内容（信息经过 hash 后的值），可以证明信息没有被修改过。hash 值一般都会加密后（也就是签名）再和信息一起发送，以保证这个 hash 值不被修改。</p> <h2 id="怎么加密"><a href="#怎么加密" class="header-anchor">#</a> 怎么加密？</h2> <p>对称加密和非对称加密各有优缺点，我们可以结合两者的优点进行加密：</p> <p><img src="/blog/assets/img/https_intro_1.9b5ce2cb.png" alt=""></p> <p>如上图所示</p> <p>（1）第 3 步时，客户端把后续使用的加密方式、加密算法和对称加密密钥组成文文，用公钥加密后发给服务器。
（2）服务器收到信息后，用私钥解密，提取出对称加密算法和对称密钥后，服务器说：（好的）对称密钥加密</p> <p>（3）后续两者之间信息的传输就可以使用对称加密的方式了</p> <p>这里存在两个问题</p> <ol><li><p>客户端怎么获得公钥。
（1）提供一个下载公钥的地址，会话前让客户端下载。但是下载地址有可能是假的，每次会话前下载也很麻烦。
（2）会话前，服务器把公钥发给客户端。如果黑客冒充服务器，发送给客户端一个假的公钥，也有问题。</p></li> <li><p>如何确认服务器是真实的而不是黑客。黑客可以伪造</p></li></ol> <h3 id="解决办法"><a href="#解决办法" class="header-anchor">#</a> 解决办法</h3> <p>使用 SSL 证书。</p> <p><img src="/blog/assets/img/https_intro_2.1db2ada0.png" alt=""></p> <p>如上图所示，在第 2 步时服务器发送了一个 SSL 证书给客户端，SSL 证书中包含的具体内容有：证书的发布机构 CA;证书的有效期;公钥;证书所有者;签名等。</p> <p>客户端接收到服务端发来的 SSL 证书时，会对证书的真伪进行校验。以浏览器为例说明如下：</p> <ol><li>首先浏览器读取证书中的证书所有者、有效期等信息进行一一校验。</li> <li>浏览器开始查找操作系统中已内置的受信任的证书发布机构 CA，与服务器发来的证书中的颁发者 CA 比对，用于校验证书是否为合法机构颁发。</li> <li>如果找不到，浏览器就会报错，说明服务器发来的证书是不可信任的。</li> <li>如果找到，那么浏览器就会从操作系统中取出 颁发者 CA 的公钥，然后对服务器发来的证书里面的签名进行解密。</li> <li>浏览器使用相同的 hash 算法计算出服务器发来的证书的 hash 值，将这个计算的 hash 值与证书中签名做对比。</li> <li>对比结果一致，则证明服务器发来的证书合法，没有被冒充.</li> <li>此时浏览器就可以读取证书中的公钥，用于后续加密了</li></ol> <p>所以通过发送 SSL 证书的形式，既解决了公钥获取问题，又解决了黑客冒充问题</p> <h2 id="tls-协议"><a href="#tls-协议" class="header-anchor">#</a> TLS 协议</h2> <p>TLS 协议可以为通信双方提供识别和认证通道，从而保证同心度额机密性和数据完整性。TLS 握手的过程类似于 TCP 建立连接时的三次握手，在握手过程中，通信双方相互验证，相互确认，并确立他们所要使用的加密算法一级会话密钥（对称加密密钥）。</p> <p><img src="/blog/assets/img/tls_handshake.bf688545.png" alt=""></p> <ol><li><p>&quot;ClientHello&quot; 客户端通过发送&quot;client hello&quot;消息向服务器发起握手请求，该消息包含了客户端所支持的 TLS 版本和密码组合以供服务器进行选择，还有一个&quot;client random&quot;随机字符串。</p></li> <li><p>&quot;Server Hello&quot;: 服务器发送&quot;server hello&quot;消息对客户端进行回应，该消息包含了数字证书，服务器选择的密码组合和&quot;server random&quot;随机字符串。</p></li> <li><p>验证：客户端对服务器发来的证书进行验证，确保对方的合法身份，验证过程可以细化为以下几个步骤：</p></li></ol> <ul><li>检查数字签名</li> <li>验证证书链 (这个概念下面会进行说明)</li> <li>检查证书的有效期</li> <li>检查证书的撤回状态 (撤回代表证书已失效)</li></ul> <ol start="4"><li><p>&quot;premaster secret&quot;字符串：客户端向服务器发送另一个随机字符串&quot;premaster secret (预主密钥)&quot;，这个字符串是经过服务器的公钥加密过的，只有对应的私钥才能解密。</p></li> <li><p>使用私钥：服务器使用私钥解密&quot;premaster secret&quot;。</p></li> <li><p>生成共享密钥：客户端和服务器均使用 client random，server random 和 premaster secret，并通过相同的算法生成相同的共享密钥</p></li> <li><p>客户端就绪：客户端发送经过共享密钥 KEY 加密过的&quot;finished&quot;信号。</p></li> <li><p>服务器就绪：服务器发送经过共享密钥 KEY 加密过的&quot;finished&quot;信号。</p></li> <li><p>达成安全通信：握手完成，双方使用对称加密进行安全通信。</p></li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">3/12/2021, 7:18:18 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.aa2e657f.js" defer></script><script src="/blog/assets/js/2.0be12a73.js" defer></script><script src="/blog/assets/js/12.b02e26d5.js" defer></script>
  </body>
</html>
